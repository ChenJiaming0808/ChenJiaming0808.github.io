# 反射的用途及实现
&emsp;&emsp;能够分析类能力的程序称为反射（reflective）。反射机制的功能极其强大，反射机制可以用来：
- 在运行时分析类的能力。
- 在运行时查看对象，例如，编写一个 toString 方法供所有类使用。
- 实现通用的数组操作代码。
- 利用 Method 对象，这个对象很像 C++ 中的函数指针。
## 反射简单示例
```java
import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

public class Apple {
    private double price;

    public double getPrice() {
        return price;
    }

    public void setPrice(double price) {
        this.price = price;
    }

    public static void main(String[] args) throws Exception {
        //正常的调用
        Apple apple = new Apple();
        apple.setPrice(5);
        System.out.println("Apple Price:" + apple.getPrice());

        //使用反射调用
        Class clz = Class.forName("Apple");
        Method setPriceMethod = clz.getMethod("setPrice", double.class);
        Constructor appleConstructor = clz.getConstructor();
        Object appleObj = appleConstructor.newInstance();
        setPriceMethod.invoke(appleObj, 14);
        Method getPriceMethod = clz.getMethod("getPrice");
        System.out.println("Apple Price:" + getPriceMethod.invoke(appleObj));
    }
}
```
&emsp;&emsp;从代码中可以看到我们使用反射调用了 setPrice 方法，并传递了 14 的值。之后使用反射调用了 getPrice 方法，输出其价格。上面的代码整个的输出结果是：
```java
Apple Price:5.0
Apple Price:14.0
```
## 反射常用 API
在 JDK 中，反射相关的 API 可以分为下面几个方面：  
- 获取反射的 Class 对象
- 通过反射创建类对象
- 通过反射获取类属性方法及构造器
### 获取反射的 Class 对象
&emsp;&emsp;在反射中，要获取一个类或调用一个类的方法，我们首先需要获取到该类的 Class 对象。  
&emsp;&emsp;在 Java API 中，获取 Class 类对象有三种方法：  
&emsp;&emsp;第一种，使用 Class.forName 静态方法。当你知道该类的全路径名时，你可以使用该方法获取 Class 类对象。
```java
Class clz = Class.forName("java.lang.String");
```
&emsp;&emsp;第二种，使用 .class 方法，这种方法只适合在编译前就知道操作的 Class。
```java
Class clz = String.class;
```
&emsp;&emsp;第三种，使用类对象的 getClass() 方法。
```java
String str = new String("Hello");
Class clz = str.getClass();
```
### 通过反射创建类对象
通过反射创建类对象主要有两种方式：通过 Class 对象的 newInstance() 方法、通过 Constructor 对象的 newInstance() 方法。

第一种：通过 Class 对象的 newInstance() 方法。

Class clz = Apple.class;
Apple apple = (Apple)clz.newInstance();
第二种：通过 Constructor 对象的 newInstance() 方法

Class clz = Apple.class;
Constructor constructor = clz.getConstructor();
Apple apple = (Apple)constructor.newInstance();
通过 Constructor 对象创建类对象可以选择特定构造方法，而通过 Class 对象则只能使用默认的无参数构造方法。下面的代码就调用了一个有参数的构造方法进行了类对象的初始化。

Class clz = Apple.class;
Constructor constructor = clz.getConstructor(String.class, int.class);
Apple apple = (Apple)constructor.newInstance("红富士", 15);
通过反射获取类属性、方法、构造器
我们通过 Class 对象的 getFields() 方法可以获取 Class 类的属性，但无法获取私有属性。

Class clz = Apple.class;
Field[] fields = clz.getFields();
for (Field field : fields) {
    System.out.println(field.getName());
}
输出结果是：

price
而如果使用 Class 对象的 getDeclaredFields() 方法则可以获取包括私有属性在内的所有属性：

Class clz = Apple.class;
Field[] fields = clz.getDeclaredFields();
for (Field field : fields) {
    System.out.println(field.getName());
}
输出结果是：

name
price
与获取类属性一样，当我们去获取类方法、类构造器时，如果要获取私有方法或私有构造器，则必须使用有 declared 关键字的方法。